<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Cohort tables</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Cohort tables</h1>



<div id="cohort-table" class="section level2">
<h2>Cohort table</h2>
<p>A cohort is a <strong>set of people that fulfill a certain set of
criteria for a period of time</strong>.</p>
<p>In omopgenerics we defined the <code>cohort_table</code> class that
allows us to represent individuals in a cohort.</p>
<p>A <code>cohort_table</code> is created using the
<code>newCohortTable()</code> function that is defined by:</p>
<ul>
<li><p>A cohort table.</p></li>
<li><p>A cohort set.</p></li>
<li><p>A cohort attrition.</p></li>
</ul>
<p>Let’s start by creating a cdm reference with just two people.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>person <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">person_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">gender_concept_id =</span> <span class="dv">0</span>, <span class="at">year_of_birth =</span> <span class="dv">1990</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">race_concept_id =</span> <span class="dv">0</span>, <span class="at">ethnicity_concept_id =</span> <span class="dv">0</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>observation_period <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">observation_period_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">person_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">observation_period_start_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-01-01&quot;</span>),</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="at">observation_period_end_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-12-31&quot;</span>),</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="at">period_type_concept_id =</span> <span class="dv">0</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">cdmFromTables</span>(</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">tables =</span> <span class="fu">list</span>(</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    <span class="st">&quot;person&quot;</span> <span class="ot">=</span> person,</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="st">&quot;observation_period&quot;</span> <span class="ot">=</span> observation_period</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  ),</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="at">cdmName =</span> <span class="st">&quot;example_cdm&quot;</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>cdm</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#&gt; ── # OMOP CDM reference (local) of example_cdm ─────────────────────────────────</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt; • omop tables: person, observation_period</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="co">#&gt; • cohort tables: -</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co">#&gt; • achilles tables: -</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="co">#&gt; • other tables: -</span></span></code></pre></div>
<p>Now let’s say one of these people have a clinical event of interest,
we can include them in a cohort table which can then be used as part of
an analysis.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>cohort <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">cohort_definition_id =</span> <span class="dv">1</span>, <span class="at">subject_id =</span> <span class="dv">1</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">cohort_start_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>),</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">cohort_end_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-10&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">insertTable</span>(<span class="at">cdm =</span> cdm, <span class="at">name =</span> <span class="st">&quot;cohort&quot;</span>, <span class="at">table =</span> cohort)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>cdm<span class="sc">$</span>cohort <span class="ot">&lt;-</span> <span class="fu">newCohortTable</span>(cdm<span class="sc">$</span>cohort)</span></code></pre></div>
<p>The cohort table will be associated with settings and attrition. As
we didn’t specify these in newCohortTable() above they will have been
automatically populated. You can access the cohort set of a cohort table
using the function <code>settings()</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">settings</span>(cdm<span class="sc">$</span>cohort)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id cohort_name</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt; &lt;chr&gt;      </span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; 1                    1 cohort_1</span></span></code></pre></div>
<p>Meanwhile, you can access the cohort attrition of a cohort table
using the function <code>attrition()</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">attrition</span>(cdm<span class="sc">$</span>cohort)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 7</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt;          &lt;int&gt;           &lt;int&gt;     &lt;int&gt; &lt;chr&gt;           </span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; 1                    1              1               1         1 Initial qualify…</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></code></pre></div>
<p>Cohort attrition table is also used to compute the number of counts
that each cohort (ie from the last row of the attrition). It can be seen
with the function <code>cohortCount()</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">cohortCount</span>(cdm<span class="sc">$</span>cohort)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt;          &lt;int&gt;           &lt;int&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; 1                    1              1               1</span></span></code></pre></div>
<p>Note that because the cohort count is taken from the last row of
attrition, if we make changes to a cohort we should then update
attrition as we go. We can do this</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>cdm<span class="sc">$</span>cohort <span class="ot">&lt;-</span> cdm<span class="sc">$</span>cohort <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">filter</span>(cohort_start_date <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-01-01&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">compute</span>(<span class="at">name =</span> <span class="st">&quot;cohort&quot;</span>, <span class="at">temporary =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">recordCohortAttrition</span>(<span class="st">&quot;Require cohort start January 1st 2019&quot;</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">attrition</span>(cdm<span class="sc">$</span>cohort)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 7</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt;          &lt;int&gt;           &lt;int&gt;     &lt;int&gt; &lt;chr&gt;           </span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; 1                    1              1               1         1 Initial qualify…</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 2                    1              0               0         2 Require cohort …</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="fu">cohortCount</span>(cdm<span class="sc">$</span>cohort)</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt;          &lt;int&gt;           &lt;int&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 1                    1              0               0</span></span></code></pre></div>
<p>An additional, optional, attribute keeps track of the concepts used
to create the cohort. In this example we do not have a codelist
associated with our cohort.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">cohortCodelist</span>(cdm<span class="sc">$</span>cohort, <span class="at">cohortId =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;index event&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; Warning: No codelists found for the specified cohorts</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; ── 0 codelists ─────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>We could though associate our cohort with a codelist</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>cdm<span class="sc">$</span>cohort <span class="ot">&lt;-</span> <span class="fu">newCohortTable</span>(cdm<span class="sc">$</span>cohort,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">cohortCodelistRef =</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="at">cohort_definition_id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="at">codelist_name =</span> <span class="fu">c</span>(<span class="st">&quot;disease X&quot;</span>, <span class="st">&quot;disease X&quot;</span>),</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="at">concept_id =</span> <span class="fu">c</span>(<span class="dv">101</span>, <span class="dv">102</span>),</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;index event&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  )</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="fu">cohortCodelist</span>(cdm<span class="sc">$</span>cohort, <span class="at">cohortId =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;index event&quot;</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; Warning: ! `codelist` casted to integers.</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; ── 1 codelist ──────────────────────────────────────────────────────────────────</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; - disease X (2 codes)</span></span></code></pre></div>
<p>Each one of the elements that define a cohort table have to fulfill
certain criteria.</p>
<div id="cohort-set" class="section level3">
<h3>Cohort Set</h3>
<p>A cohort set must be a table with:</p>
<ul>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, cohort_name columns
(<code>cohortColumns(&quot;cohort_set&quot;)</code>).</p></li>
<li><p><code>cohort_name</code> it must contain unique cohort names
(currently they are cased to snake case).</p></li>
<li><p><code>cohort_definition_id</code> it must contain unique cohort
ids, all the ids present in table must be present in the cohort set and
the same ids must be present in cohort attrition.</p></li>
</ul>
</div>
<div id="cohort-attrition" class="section level3">
<h3>Cohort Attrition</h3>
<p>A cohort attrition must be a table with:</p>
<ul>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, number_records, number_subjects,
reason_id, reason, excluded_records, excluded_subjects columns
(<code>cohortColumns(&quot;cohort_attrition&quot;)</code>).</p></li>
<li><p><code>cohort_definition_id</code> it must contain cohort ids, all
the ids present in table must be present in the cohort attrition and the
same ids must be present in cohort set.</p></li>
<li><p>There must exist unique pairs of
<code>cohort_definition_id</code> and <code>reason_id</code>.</p></li>
</ul>
</div>
<div id="cohort-codelist" class="section level3">
<h3>Cohort Codelist</h3>
<p>A cohort codelist must be a table with:</p>
<ul>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, codelist_name, concept_id, type
columns (<code>cohortColumns(&quot;cohort_codelist&quot;)</code>).</p></li>
<li><p><code>cohort_definition_id</code> it must contain cohort ids, all
the ids present in table must be present in the cohort attrition and the
same ids must be present in cohort set.</p></li>
<li><p><code>type</code> must be one of “index event”, “inclusion
criteria”, and “exit criteria”</p></li>
</ul>
</div>
<div id="cohort-table-1" class="section level3">
<h3>Cohort Table</h3>
<p>A cohort table must be a table with:</p>
<ul>
<li><p>It comes from a cdm_reference (extracted via
<code>cdm$cohort</code>).</p></li>
<li><p>It has the same source than this cdm_reference.</p></li>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, subject_id, cohort_start_date,
cohort_end_date columns (<code>cohortColumns(&quot;cohort&quot;)</code>).</p></li>
<li><p>There is no record with <code>NA</code> value in the required
columns.</p></li>
<li><p>There is no record with <code>cohort_start_date</code> after
<code>cohort_end_date</code>.</p></li>
<li><p>There is no overlap between records. A person can be in a cohort
several times (several records with the same subject_id). But it can’t
enter (cohort_start_date) the cohort again before leaving it
(cohort_end_date). So an individual can’t be simultaneously more than
once in the same cohort. This rule is applied at the
cohort_definition_id level, so records with different
cohort_definition_id can overlap.</p></li>
<li><p>All the time between cohort_start_date and cohort_end_date (both
included) the individual must be in observation.</p></li>
</ul>
</div>
</div>
<div id="combining-generated-cohort-sets" class="section level2">
<h2>Combining generated cohort sets</h2>
<p>You can bind two cohort tables using the method <code>bind()</code>.
You can combine several cohort tables using this method. The only
constrain is that cohort names must be unique across the different
cohort tables. You have to provide a name for the new cohort table.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>asthma <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="at">cohort_definition_id =</span> <span class="dv">1</span>, <span class="at">subject_id =</span> <span class="dv">1</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">cohort_start_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">cohort_end_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-10&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">insertTable</span>(cdm, <span class="at">name =</span> <span class="st">&quot;asthma&quot;</span>, <span class="at">table =</span> asthma)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>cdm<span class="sc">$</span>asthma <span class="ot">&lt;-</span> <span class="fu">newCohortTable</span>(cdm<span class="sc">$</span>asthma,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="at">cohortSetRef =</span> <span class="fu">tibble</span>(</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="at">cohort_definition_id =</span> <span class="dv">1</span>,</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="at">cohort_name =</span> <span class="st">&quot;asthma&quot;</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>  )</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>copd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  <span class="at">cohort_definition_id =</span> <span class="dv">1</span>, <span class="at">subject_id =</span> <span class="dv">2</span>,</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>  <span class="at">cohort_start_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>),</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  <span class="at">cohort_end_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-10&quot;</span>)</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>)</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">insertTable</span>(cdm, <span class="at">name =</span> <span class="st">&quot;copd&quot;</span>, <span class="at">table =</span> copd)</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>cdm<span class="sc">$</span>copd <span class="ot">&lt;-</span> <span class="fu">newCohortTable</span>(cdm<span class="sc">$</span>copd,</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>  <span class="at">cohortSetRef =</span> <span class="fu">tibble</span>(</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>    <span class="at">cohort_definition_id =</span> <span class="dv">1</span>,</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>    <span class="at">cohort_name =</span> <span class="st">&quot;copd&quot;</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>  )</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>)</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>cdm <span class="ot">&lt;-</span> <span class="fu">bind</span>(cdm<span class="sc">$</span>asthma,</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>  cdm<span class="sc">$</span>copd,</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&quot;exposures&quot;</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>)</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>cdm<span class="sc">$</span>exposures</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt; *                &lt;int&gt;      &lt;dbl&gt; &lt;date&gt;            &lt;date&gt;         </span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt; 1                    1          1 2020-01-01        2020-01-10     </span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt; 2                    2          2 2020-01-01        2020-01-10</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="fu">settings</span>(cdm<span class="sc">$</span>exposures)</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id cohort_name</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt; &lt;chr&gt;      </span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="co">#&gt; 1                    1 asthma     </span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co">#&gt; 2                    2 copd</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="fu">attrition</span>(cdm<span class="sc">$</span>exposures)</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 7</span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt;          &lt;int&gt;           &lt;int&gt;     &lt;int&gt; &lt;chr&gt;           </span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="co">#&gt; 1                    1              1               1         1 Initial qualify…</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="co">#&gt; 2                    2              1               1         1 Initial qualify…</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a><span class="fu">cohortCount</span>(cdm<span class="sc">$</span>exposures)</span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a><span class="co">#&gt;                  &lt;int&gt;          &lt;int&gt;           &lt;int&gt;</span></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a><span class="co">#&gt; 1                    1              1               1</span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="co">#&gt; 2                    2              1               1</span></span></code></pre></div>
</div>
<div id="export-metadata-about-a-cohort-table" class="section level2">
<h2>Export metadata about a cohort table</h2>
<p>You can export the metadata of a <code>cohort_table</code> using the
function: <code>summary()</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">summary</span>(cdm<span class="sc">$</span>exposures) <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; `cohort_definition_id` casted to character.</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; `cohort_definition_id` casted to character.</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; Rows: 12</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; Columns: 13</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; $ result_id        &lt;int&gt; 1, 1, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; $ cdm_name         &lt;chr&gt; &quot;example_cdm&quot;, &quot;example_cdm&quot;, &quot;example_cdm&quot;, &quot;example…</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; $ group_name       &lt;chr&gt; &quot;cohort_name&quot;, &quot;cohort_name&quot;, &quot;cohort_name&quot;, &quot;cohort_…</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; $ group_level      &lt;chr&gt; &quot;asthma&quot;, &quot;asthma&quot;, &quot;copd&quot;, &quot;copd&quot;, &quot;asthma&quot;, &quot;asthma…</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; $ strata_name      &lt;chr&gt; &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;reason&quot;,…</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; $ strata_level     &lt;chr&gt; &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;Initial …</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; $ variable_name    &lt;chr&gt; &quot;number_records&quot;, &quot;number_subjects&quot;, &quot;number_records&quot;…</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; $ variable_level   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; $ estimate_name    &lt;chr&gt; &quot;count&quot;, &quot;count&quot;, &quot;count&quot;, &quot;count&quot;, &quot;count&quot;, &quot;count&quot;,…</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; $ estimate_type    &lt;chr&gt; &quot;integer&quot;, &quot;integer&quot;, &quot;integer&quot;, &quot;integer&quot;, &quot;integer&quot;…</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; $ estimate_value   &lt;chr&gt; &quot;1&quot;, &quot;1&quot;, &quot;1&quot;, &quot;1&quot;, &quot;1&quot;, &quot;1&quot;, &quot;0&quot;, &quot;0&quot;, &quot;1&quot;, &quot;1&quot;, &quot;0&quot;…</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; $ additional_name  &lt;chr&gt; &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;reason_i…</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; $ additional_level &lt;chr&gt; &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;overall&quot;, &quot;1&quot;, &quot;1&quot;,…</span></span></code></pre></div>
<p>This will provide a <code>summarised_result</code> object with the
metadata of the cohort (cohort set, cohort counts and cohort
attrition).</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
